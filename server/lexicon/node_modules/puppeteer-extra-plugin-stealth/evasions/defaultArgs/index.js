'use strict'

const { PuppeteerExtraPlugin } = require('puppeteer-extra-plugin')

const argsToIgnore = [
  '--disable-extensions',
  '--disable-default-apps',
  '--disable-component-extensions-with-background-pages'
]

class Plugin extends PuppeteerExtraPlugin {
  constructor(opts = {}) {
    super(opts)
  }

  get name() {
    return 'stealth/evasions/defaultArgs'
  }

  get requirements() {
    return new Set(['runLast']) 
  }

  async beforeLaunch(options = {}) {
    options.ignoreDefaultArgs = options.ignoreDefaultArgs || []
    if (options.ignoreDefaultArgs === true) {
      
      return
    }
    argsToIgnore.forEach(arg => {
      if (options.ignoreDefaultArgs.includes(arg)) {
        return
      }
      options.ignoreDefaultArgs.push(arg)
    })
  }
}

module.exports = function (pluginConfig) {
  return new Plugin(pluginConfig)
}

module.exports.argsToIgnore = argsToIgnore
